<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Add a habit</title>
		<link rel="stylesheet" href="../css/forms.css">
		<script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

	</head>
	<body>

		<div style="height:0px; overflow:hidden">
			<input type="file" id="myFile" multiple size="50" onchange="uploadIcon()">
		</div>

		<div class="forms">
			<h2>Add A Habit</h2>
			<form id ="form">
				<p><label><span id="title_text">Habit Title</span></label></p>
				<p><input id="title" type="text" name="fullname" placeholder="Exercise 30 minutes" value=""></p>
				<p><label>Habit Icon</label></p>
				<img id="icon1" class="icon" onclick="selectImage('icon1');" src="../img/sleep.jpg" alt="sleep image"/>
				<img id="icon2" class="icon" onclick="selectImage('icon2');" src="../img/salad.jpg" alt="eat image"/>
				<img id="icon3" class="icon" onclick="selectImage('icon3');" src="../img/run.jpg" alt="run image"/>

				<label class="myFile">
					<img id="icon4" class="icon" onchange="uploadIcon()" src="../img/add.png" alt="find a image" />
					<input type="file" id="iconFileUpload" />
				</label>

				<div class="hide">
					<img id="myImg" class = "icon" onclick="selectImage('myImg');" src="#" alt=""/>
				</div>

				<p><label>Weekly Frequency</label></p>
				<div id="ck-button">
					<label> <input id="isSun" type="checkbox" name="date" value="sunday"><span>Sun</span></label>
					<label> <input id="isMon" type="checkbox" name="date" value="monday"><span>Mon</span></label>
					<label> <input id="isTues" type="checkbox" name="date" value="tuesday"><span>Tues</span></label>
					<label> <input id="isWed" type="checkbox" name="date" value="wednesday"><span>Wed</span></label>
					<label> <input id="isThurs" type="checkbox" name="date" value="thursday"><span>Thur</span></label>
					<label> <input id="isFri" type="checkbox" name="date" value="friday"><span>Fri</span></label>
					<label> <input id="isSat" type="checkbox" name="date" value="saturday"><span>Sat</span></label>
				</div>


				<p><label>Daily Frequency</label></p>
				<div id="daily-button">
					<label> <input id="once" type="radio" name="day" value="one" onchange="notify();"><span>1</span></label>
					<label> <input id="twice" type="radio" name="day" value="two" onchange="notify();"><span>2</span></label>
					<label> <input id="thrice" type="radio" name="day" value="three" onchange="notify();"><span>3</span></label>
					<span id="times">times</span>
				</div>

				<p><label><span id="others_text">Others: </span><input id="others" type="text" name="day" placeholder="More than 3 times"></label></p>

				<p><label>Notifications</label></p>
				<div class="onoffswitch" >
   					<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" checked onclick="incCounter();">
    				<label class="onoffswitch-label" for="myonoffswitch">
        			<span class="onoffswitch-inner"></span>
        			<span class="onoffswitch-switch"></span>
    				</label>
				</div>

			<div class="notifications1">
			<p id="alarm">Alarm 1</p>
				<select id="hr1">
  					<option value="1">1</option>
 					<option value="2">2</option>
  					<option value="3">3</option>
				  	<option value="4">4</option>
  					<option value="5">5</option>
 					<option value="6">6</option>
  					<option value="7">7</option>
				  	<option value="8">8</option>
  					<option value="9">9</option>
 					<option value="10">10</option>
  					<option value="11">11</option>
				  	<option value="12">12</option>
				</select>

				<select id="min1">
  					<option value="00">:00</option>
 					<option value="01">:01</option>
  					<option value="02">:02</option>
				  	<option value="03">:03</option>
  					<option value="04">:04</option>
 					<option value="05">:05</option>
 					<option value="06">:06</option>
  					<option value="07">:07</option>
				  	<option value="08">:08</option>
  					<option value="09">:09</option>
 					<option value="10">:10</option>
  					<option value="11">:11</option>
				  	<option value="12">:12</option>
				  	<option value="13">:13</option>
  					<option value="14">:14</option>
 					<option value="15">:15</option>
 					<option value="16">:16</option>
  					<option value="17">:17</option>
				  	<option value="18">:18</option>
  					<option value="19">:19</option>
 					<option value="20">:20</option>
  					<option value="21">:21</option>
				  	<option value="22">:22</option>
				  	<option value="23">:23</option>
  					<option value="24">:24</option>
 					<option value="25">:25</option>
 					<option value="26">:26</option>
  					<option value="27">:27</option>
				  	<option value="28">:28</option>
  					<option value="29">:29</option>
 					<option value="30">:30</option>
  					<option value="31">:31</option>
				  	<option value="32">:32</option>
				  	<option value="33">:33</option>
  					<option value="34">:34</option>
 					<option value="35">:35</option>
 					<option value="36">:36</option>
  					<option value="37">:37</option>
				  	<option value="38">:38</option>
  					<option value="39">:39</option>
  					<option value="40">:40</option>
  					<option value="41">:41</option>
				  	<option value="42">:42</option>
				  	<option value="43">:43</option>
  					<option value="44">:44</option>
 					<option value="45">:45</option>
 					<option value="46">:46</option>
  					<option value="47">:47</option>
				  	<option value="48">:48</option>
  					<option value="49">:49</option>
 					<option value="50">:50</option>
  					<option value="51">:51</option>
				  	<option value="52">:52</option>
				  	<option value="53">:53</option>
  					<option value="54">:54</option>
 					<option value="55">:55</option>
 					<option value="56">:56</option>
  					<option value="57">:57</option>
				  	<option value="58">:58</option>
  					<option value="59">:59</option>
				</select>

				<select id="am1">
  					<option value="am">am</option>
 					<option value="pm">pm</option>
				</select>
			</div>	

		<div class="notifications2">
			<p id="alarm">Alarm 2</p>
				<select id="hr2">
  					<option value="1">1</option>
 					<option value="2">2</option>
  					<option value="3">3</option>
				  	<option value="4">4</option>
  					<option value="5">5</option>
 					<option value="6">6</option>
  					<option value="7">7</option>
				  	<option value="8">8</option>
  					<option value="9">9</option>
 					<option value="10">10</option>
  					<option value="11">11</option>
				  	<option value="12">12</option>
				</select>

				<select id="min2">
  					<option value="00">:00</option>
 					<option value="01">:01</option>
  					<option value="02">:02</option>
				  	<option value="03">:03</option>
  					<option value="04">:04</option>
 					<option value="05">:05</option>
 					<option value="06">:06</option>
  					<option value="07">:07</option>
				  	<option value="08">:08</option>
  					<option value="09">:09</option>
 					<option value="10">:10</option>
  					<option value="11">:11</option>
				  	<option value="12">:12</option>
				  	<option value="13">:13</option>
  					<option value="14">:14</option>
 					<option value="15">:15</option>
 					<option value="16">:16</option>
  					<option value="17">:17</option>
				  	<option value="18">:18</option>
  					<option value="19">:19</option>
 					<option value="20">:20</option>
  					<option value="21">:21</option>
				  	<option value="22">:22</option>
				  	<option value="23">:23</option>
  					<option value="24">:24</option>
 					<option value="25">:25</option>
 					<option value="26">:26</option>
  					<option value="27">:27</option>
				  	<option value="28">:28</option>
  					<option value="29">:29</option>
 					<option value="30">:30</option>
  					<option value="31">:31</option>
				  	<option value="32">:32</option>
				  	<option value="33">:33</option>
  					<option value="34">:34</option>
 					<option value="35">:35</option>
 					<option value="36">:36</option>
  					<option value="37">:37</option>
				  	<option value="38">:38</option>
  					<option value="39">:39</option>
  					<option value="40">:40</option>
  					<option value="41">:41</option>
				  	<option value="42">:42</option>
				  	<option value="43">:43</option>
  					<option value="44">:44</option>
 					<option value="45">:45</option>
 					<option value="46">:46</option>
  					<option value="47">:47</option>
				  	<option value="48">:48</option>
  					<option value="49">:49</option>
 					<option value="50">:50</option>
  					<option value="51">:51</option>
				  	<option value="52">:52</option>
				  	<option value="53">:53</option>
  					<option value="54">:54</option>
 					<option value="55">:55</option>
 					<option value="56">:56</option>
  					<option value="57">:57</option>
				  	<option value="58">:58</option>
  					<option value="59">:59</option>
				</select>

				<select id="am2">
  					<option value="am">am</option>
 					<option value="pm">pm</option>
				</select>
			</div>	

			<div class="notifications3">
				<p id="alarm">Alarm 3</p>
				<select id="hr3">
  					<option value="1">1</option>
 					<option value="2">2</option>
  					<option value="3">3</option>
				  	<option value="4">4</option>
  					<option value="5">5</option>
 					<option value="6">6</option>
  					<option value="7">7</option>
				  	<option value="8">8</option>
  					<option value="9">9</option>
 					<option value="10">10</option>
  					<option value="11">11</option>
				  	<option value="12">12</option>
				</select>

				<select id="min3">
  					<option value="00">:00</option>
 					<option value="01">:01</option>
  					<option value="02">:02</option>
				  	<option value="03">:03</option>
  					<option value="04">:04</option>
 					<option value="05">:05</option>
 					<option value="06">:06</option>
  					<option value="07">:07</option>
				  	<option value="08">:08</option>
  					<option value="09">:09</option>
 					<option value="10">:10</option>
  					<option value="11">:11</option>
				  	<option value="12">:12</option>
				  	<option value="13">:13</option>
  					<option value="14">:14</option>
 					<option value="15">:15</option>
 					<option value="16">:16</option>
  					<option value="17">:17</option>
				  	<option value="18">:18</option>
  					<option value="19">:19</option>
 					<option value="20">:20</option>
  					<option value="21">:21</option>
				  	<option value="22">:22</option>
				  	<option value="23">:23</option>
  					<option value="24">:24</option>
 					<option value="25">:25</option>
 					<option value="26">:26</option>
  					<option value="27">:27</option>
				  	<option value="28">:28</option>
  					<option value="29">:29</option>
 					<option value="30">:30</option>
  					<option value="31">:31</option>
				  	<option value="32">:32</option>
				  	<option value="33">:33</option>
  					<option value="34">:34</option>
 					<option value="35">:35</option>
 					<option value="36">:36</option>
  					<option value="37">:37</option>
				  	<option value="38">:38</option>
  					<option value="39">:39</option>
  					<option value="40">:40</option>
  					<option value="41">:41</option>
				  	<option value="42">:42</option>
				  	<option value="43">:43</option>
  					<option value="44">:44</option>
 					<option value="45">:45</option>
 					<option value="46">:46</option>
  					<option value="47">:47</option>
				  	<option value="48">:48</option>
  					<option value="49">:49</option>
 					<option value="50">:50</option>
  					<option value="51">:51</option>
				  	<option value="52">:52</option>
				  	<option value="53">:53</option>
  					<option value="54">:54</option>
 					<option value="55">:55</option>
 					<option value="56">:56</option>
  					<option value="57">:57</option>
				  	<option value="58">:58</option>
  					<option value="59">:59</option>
				</select>

				<select id="am3">
  					<option value="am">am</option>
 					<option value="pm">pm</option>
				</select>
			</div>	

			<p id="save_p"><input id="save" type="button" value="Save It" onclick="addHabit();"></p> <!-- onclick ="location.href='list.html'" -->

			</form>

		</div>

		<script>
			Parse.initialize("Ih70t530LwJAnRJungwuPtE2nE3eakzmwVuZHb6O", "sE6Y6iMcoTTa9Z3pBCaAtwnD9F1L9SlWHBKlDQ7h");

			var counter = 0;
			var Habit = Parse.Object.extend("Habit");
			var habit = new Habit();


			function selectImage(name) {
				//Clear all the other effects
				document.getElementById('icon1').style.border = "none";
				document.getElementById('icon2').style.border = "none";
				document.getElementById('icon3').style.border = "none";
				document.getElementById('icon4').style.border = "none";
				var image = document.getElementById(name);
				image.style.border = "5px solid #42A5F5";

			}

			function notify() {
				if( counter % 2 == 1) {
					$('.notifications1').css('display','none');
					$('.notifications2').css('display','none');
					$('.notifications3').css('display','none');
				} else {
					switch ($("input[name='day']:checked").val()) {
						case "one":
							$('.notifications1').css('display','block');
							$('.notifications2').css('display','none');
							$('.notifications3').css('display','none');		
							break;
						case "two":
							$('.notifications1').css('display','block');
							$('.notifications2').css('display','block');	
							$('.notifications3').css('display','none');
							break;
						case "three":
							$('.notifications1').css('display','block');
							$('.notifications2').css('display','block');
							$('.notifications3').css('display','block');
							break;
						default: 
							$('.notifications1').css('display','block');	
					}

				}
			}

			function incCounter() {
				counter ++;
				notify();
			}

			/* function getFileBlob(url, cb) {
		        var xhr = new XMLHttpRequest();
		        xhr.open("GET", url);
		        xhr.responseType = "blob";
		        xhr.addEventListener('load', function() {
		            cb(xhr.response);
		        });
		        xhr.send();
			}

			function blobToFile(blob, name) {
		        blob.lastModifiedDate = new Date();
		        blob.name = name;
		        return blob;
			}

			function getFileObject(filePathOrUrl, cb) {
		       getFileBlob(filePathOrUrl, function (blob) {
		          cb(blobToFile(blob, 'test.jpg'));
		       });
			} */

			function addHabit() {
				var habitToAdd = new Habit();

				habitToAdd.set("username", "smarties");
				habitToAdd.set("name", document.getElementById("title").value);

				// Image upload
				var fileUploadControl = $("#iconFileUpload")[0];
				if (fileUploadControl.files.length > 0) {
					var file = fileUploadControl.files[0];
					var name = "icon.jpg";

					var parseFile = new Parse.File(name, file);
				}

				parseFile.save().then(function() {
					// The file has been saved to Parse.
				}, function(error) {
					// The file either could not be read, or could not be saved to Parse.
				});
				habitToAdd.set("icon", parseFile);

				/* getFileObject('../img/sleep.jpg', function (fileObject) {
					console.log('selecting image works??');
     				console.log(fileObject);
				}); */

				habitToAdd.set("onSunday", document.getElementById('isSun').checked);
				habitToAdd.set("onMonday", document.getElementById('isMon').checked);
				habitToAdd.set("onTuesday", document.getElementById('isTues').checked);
				habitToAdd.set("onWednesday", document.getElementById('isWed').checked);
				habitToAdd.set("onThursday", document.getElementById('isThurs').checked);
				habitToAdd.set("onFriday", document.getElementById('isFri').checked);
				habitToAdd.set("onSaturday", document.getElementById('isSat').checked);
				habitToAdd.set("currStreak", 0);
				habitToAdd.set("bestStreak", 0);

				var otherFrequency = document.getElementById('others').value;
				var frequency;

				if(!(otherFrequency == null || otherFrequency == "")) {
					frequency = Number(otherFrequency);
				} else if(document.getElementById('once').checked) {
					frequency = 1;
				} else if(document.getElementById('twice').checked) {
					frequency = 2;
				} else if(document.getElementById('thrice').checked) {
					frequency = 3;
				} else {
					// DISABLE SAVE FORM OR SOMETHING???
				}
				habitToAdd.set("frequency", frequency);

				habitToAdd.save(null, {
					success: function(habitToAdd) {
						// Execute any logic that should take place after the object is saved.
						// alert('New object created with objectId: ' + habitToAdd.id);

						console.log('new object created with objectId: ' + habitToAdd.id);
						location = "list.html"
					},
					error: function(habitToAdd, error) {
						// Execute any logic that should take place if the save fails.
						// error is a Parse.Error with an error code and message.
						alert('Failed to create new object, with error code: ' + error.message);
					}
				});
			}

			function uploadIcon(){
	    		var x = document.getElementById("myFile");
	    		var txt = "";
	    		if ('files' in x) {
	        		if (x.files.length == 0) {
	            		txt = "Select one or more files.";
	        		} else {
	            		for (var i = 0; i < x.files.length; i++) {
		                	txt += "<br><strong>" + (i+1) + ". file</strong><br>";
		                	var file = x.files[i];

		               	 	if ('name' in file) {
		                    	txt += "name: " + file.name + "<br>";
		                	}
	                		if ('size' in file) {
	                   			txt += "size: " + file.size + " bytes <br>";
	                		}
	            		}
	        		}
				}

    			else if (x.value == "") {
            		txt += "Select one or more files.";
        		}

        		else {
	            	txt += "The files property is not supported by your browser!";
	            	txt  += "<br>The path of the selected file: " + x.value; // If the browser does not support the files property, it will return the path of the selected file instead.
        		}
    		}


			$(function () {
			    $(":file").change(function () {
			        if (this.files && this.files[0]) {
			            var reader = new FileReader();
			            reader.onload = imageIsLoaded;
			            reader.readAsDataURL(this.files[0]);
			        }
			    });
			});

			function imageIsLoaded(e) {
				$('.hide').css('display','block');
			    $('#myImg').attr('src', e.target.result);
			};

		</script>
	</body>
</html>
