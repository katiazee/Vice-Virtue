function initialiseState(){return"showNotification"in ServiceWorkerRegistration.prototype?"denied"===Notification.permission?(document.querySelector(".onoffswitch-checkbox").setAttribute("disabled",!0),document.getElementById("noNotifications").style.display="block",void(document.getElementById("noNotifications").textContent="Enable notifications in your browser in order to receive push notifications")):"PushManager"in window?void 0:(document.querySelector(".onoffswitch-checkbox").setAttribute("disabled",!0),document.getElementById("noNotifications").style.display="block",void(document.getElementById("noNotifications").textContent="Push notifications are not supported in your browser")):(console.warn("Notifications aren't supported."),void document.querySelector(".onoffswitch-checkbox").setAttribute("disabled",!0))}function subscribe(){console.log("subscribing");var e=document.querySelector(".onoffswitch-checkbox");navigator.serviceWorker.ready.then(function(t){t.pushManager.getSubscription().then(function(e){var o=document.querySelector(".onoffswitch-checkbox");return o.disabled=!1,e?(console.log(e),sendSubscriptionToServer(e),void(isPushEnabled=!0)):void t.pushManager.subscribe({userVisibleOnly:!0}).then(function(e){console.log("here - success"),console.log("endpoint:",e.endpoint),isPushEnabled=!0,console.log(e),sendSubscriptionToServer(e)})["catch"](function(e){"denied"===Notification.permission?(document.querySelector(".onoffswitch-checkbox").setAttribute("disabled",!0),document.getElementById("noNotifications").style.display="block",document.getElementById("noNotifications").textContent="Enable notifications in your browser in order to receive push notifications",o.disabled=!0):(document.querySelector(".onoffswitch-checkbox").setAttribute("disabled",!0),document.getElementById("noNotifications").style.display="block",document.getElementById("noNotifications").textContent="Unfortunately, we were unable to enable notifications",console.log(e))})})["catch"](function(t){console.warn("Error during getSubscription()",t),document.querySelector(".onoffswitch-checkbox").setAttribute("disabled",!1),document.getElementById("noNotifications").style.display="block",document.getElementById("noNotifications").textContent="Unfortunately, we were unable to enable notifications",e.disabled=!0})})}function sendSubscriptionToServer(e){console.log(e),console.log("endpoint:",e.endpoint),$.ajax({url:"https://vice-virtue.herokuapp.com/subscribe",type:"POST",data:{endpoint:e.endpoint},dataType:"json",success:function(e){switch(e){case!0:processResponse(e);break;default:resultDiv.html(e)}},error:function(e,t,o){}})}var isPushEnabled=!1;window.addEventListener("load",function(){var e=document.querySelector(".onoffswitch-checkbox"),t=location.protocol;"https:"!==t&&(document.querySelector(".onoffswitch-checkbox").setAttribute("disabled",!0),document.getElementById("noNotifications").style.display="block",document.getElementById("noNotifications").textContent="Notifications only work over secure HTTPS."),e.addEventListener("click",function(e){console.log("switched"),e.target.checked&&subscribe()}),"serviceWorker"in navigator?navigator.serviceWorker.register("../worker.js").then(initialiseState):(console.warn("Service workers aren't supported in this browser."),document.querySelector(".onoffswitch-checkbox").setAttribute("disabled",!0),document.getElementById("noNotifications").style.display="block")});